@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title Browser containers diagram
LAYOUT_WITH_LEGEND()

' system itself
System_Boundary(browserSystem, "Browser with web extension") {
  Container_Boundary(browserContainer, "Pure browser") {
    Container_Ext(browserCore, "Content filtering API", "Native")
    Container_Ext(browserApi, "Public API", "Native")
    Container_Ext(matcher, "Matcher", "Native")
    ContainerDb_Ext(indexeddb, "IndexedDB API", "Native")
    Container_Ext(schedulers, "Alert API", "Native")
  }

  Container_Boundary(webExtContainer, "Web Extension") {
    Container(webExtContent, "Content script", "JavaScript", "Injected into web page context")
    Container(webExtBackground, "Background script", "JavaScript", "Service worker")
  }
}

System_Boundary(backEndContainer, "Back-end") {
    Container(backEnd, "Back-end", "JavaScript")
}

' relations
Rel_U(webExtBackground, browserCore, "Setup filter rules (DNR mark-up)")
Rel_U(webExtBackground, browserCore, "Request matched rules")
Rel_U(webExtContent, browserApi, "Injects user stylesheet/CSS")
Rel_U(webExtBackground, indexeddb, "Persists the data in")
Rel_U(webExtBackground, schedulers, "Uses for scheduling")
Rel_R(browserCore, matcher, "Uses")
Rel_D(webExtBackground, backEnd, "Fetches the changes from", "HTTP")
Rel_L(webExtBackground, webExtContent, "Communicates with")
@enduml